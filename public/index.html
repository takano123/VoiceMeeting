<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <!--link rel="icon" href="%PUBLIC_URL%/favicon.ico" crossorigin="use-credentials"-->
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#000000" />
    <meta
      name="description"
      content="Web site created using create-react-app"
    />
    <link rel="apple-touch-icon" href="%PUBLIC_URL%/logo192.png" />
    <!--
      manifest.json provides metadata used when your web app is installed on a
      user's mobile device or desktop. See https://developers.google.com/web/fundamentals/web-app-manifest/
    -->
    <!--link rel="manifest" href="%PUBLIC_URL%/manifest.json" crossorigin="use-credentials"-->
    <!--
      Notice the use of %PUBLIC_URL% in the tags above.
      It will be replaced with the URL of the `public` folder during the build.
      Only files inside the `public` folder can be referenced from the HTML.

      Unlike "/favicon.ico" or "favicon.ico", "%PUBLIC_URL%/favicon.ico" will
      work correctly both with client-side routing and a non-root public URL.
      Learn how to configure a non-root public URL by running `npm run build`.
    -->
    <title>VMダッシュボード</title>

    <!--
    <script src="https://unpkg.com/axios/dist/axios.min.js" defer></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
    <script>
      //指定パラメータ取得処理(貰い物)
      function getParameterByHash(name, url) {
          let wHash = window.location.hash; //ハッシュ(#)以降をとる
          wHash = wHash.replace('#', '&'); //↓の処理を使いたいがために#を&に変換するorzorz
          name = name.replace(/[\[\]]/g, "\\$&");
          let regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
              results = regex.exec(wHash);
          if (!results) return null;
          if (!results[2]) return null;
          return decodeURIComponent(results[2].replace(/\+/g, " "));
      }
  
      //認証済みか検証を行い、ユーザー情報を取得する(認証未済の場合はログインページにリダイレクトする)
      function checkSession() {
  
          //パスパラメータの取得
          let idToken = getParameterByHash('id_token');
          let accessToken = getParameterByHash('access_token');
  
          console.log("id_token:" && idToken);
          console.log("access_token:" && accessToken);
  
          if(sessionStorage.idToken == undefined || sessionStorage.accessToken == undefined){
            console.log("ローカルストレージが未定義、またはNullだったので、作成");
            //sessionStorage
            let storage = sessionStorage;
            storage.setItem("idToken", idToken);
            storage.setItem("accessToken", accessToken);
          }
  
          
          //トークンが未発行だったらローカルストレージをチェック
          if (idToken == null || accessToken == null || idToken == 'null' || accessToken == 'null') {
            console.log("トークン未発行");
            console.log("sessionStorage.idToken:" && sessionStorage.idToken);
            console.log("sessionStorage.accessToken:" && sessionStorage.accessToken);
  
            //ローカルストレージにトークンが格納されていなければログインページへ遷移
            if (sessionStorage.idToken == null || sessionStorage.accessToken == null || sessionStorage.idToken == 'null' || sessionStorage.accessToken == 'null') {
              console.log("ローカルストレージにトークン未格納");
              // window.location.href = 'ログインページのURL';
              window.location.href = 'https://takaaatest.auth.ap-northeast-1.amazoncognito.com/login?response_type=token&client_id=6vtmk2lu90m8i8k853siqtfgqt&redirect_uri=https://d37g3071e3h6f6.cloudfront.net';
              console.log("ログインページに遷移。");
            }
            
              console.log("ローカルストレージにトークンが格納されていたと判断");
              //showView
              console.log("Start:showView(ローカルストレージにトークン格納済み)");
              showView();
  
              // });
  
          }else{
            console.log("トークン発行済みと判断");
            let storage = sessionStorage;
            storage.setItem("idToken", idToken);
            storage.setItem("accessToken", accessToken);
  
            //ユーザー情報取得
            const requestAws = axios.create({});
            // requestAws.get('https://{ドメイン名}.auth.{リージョン名}.amazoncognito.com/oauth2/userInfo', {
            requestAws.get('https://takaaatest.auth.ap-northeast-1.amazoncognito.com/oauth2/userInfo', {
              headers: {
                Authorization: " Bearer " + accessToken
              }
              })
              .then(function(response) {
              responseJson = JSON.parse(JSON.stringify(response));
              console.log(responseJson)
  
              //ユーザー名をローカルストレージに保存
              //storage.setItem("userName", responseJson.data.username);
              //document.getElementById("userName").innerText = responseJson.data.username.substring(responseJson.data.username.indexOf("_") + 1);
              storage.setItem("userName", responseJson.data.username.substring(responseJson.data.username.indexOf("_") + 1));
              //$("#userName").primary(sessionStorage.getItem("userName"));
              //document.getElementById("userName").innerText = sessionStorage.getItem("userName")
              //showView
              console.log("Start:showView(トークン発行済み)");
              showView();
  
              });
          }
  
      }
  
      // ログイン認証完了後画面表示処理
      function showView() {
  
          // プレーヤーの表示
          document.getElementById('root').hidden = false;
          console.log(sessionStorage)
          console.log(localStorage)
        
  
      }
  
      //初期処理(ページ読み込み時にロードされる)
      $(function() {
          console.log("Start");
  
          // // プレーヤーの非表示
          document.getElementById('root').hidden = true;
  
          // 認証チェック
          console.log("Start:checkSession");
          checkSession();
  
      });
    </script>
    -->
  

  </head>
  <body>
    <noscript>You need to enable JavaScript to run this app.</noscript>
    <div id="root"></div>

      <!--
      This HTML file is a template.
      If you open it directly in the browser, you will see an empty page.

      You can add webfonts, meta tags, or analytics to this file.
      The build step will place the bundled scripts into the <body> tag.

      To begin the development, run `npm start` or `yarn start`.
      To create a production bundle, use `npm run build` or `yarn build`.
    -->
  </body>



</html>
